# 문제 상황
- **이 글을 기록하는 현재 시각은 2026.01.22 17:30이고 어제 오후 이 문제를 겪었음.**
- AI 레포지토리의 파이썬 라이브러리들 venv에 설치 시도
- pip install -r requirements.txt 실행 중 프로세스가 killed됨
- swap 2G 설정하여 OOM kill 당하는 문제는 해결
- 이제는 설치할 라이브러리들의 총 용량이 너무 커서 디스크 용량 부족으로 실패
- requirements.txt 명세를 보니 vllm, torch와 같이 MVP에서는 없는 기능들을 위한 라이브러리들이 있는 것을 발견하고 jayvi(AI 개발 팀원)에게 그런 것들은 requirements.txt에서 제외해줄 것을 요청
- 이후 다시 설치를 시도했으나 여전히 실패
- pip cache를 삭제했더니 성공
- 해결되긴 했지만 왠지 원인이 무엇인지 명확히 이해되지 않았음. 사실 이때 휴식을 취했어야함.
- 그래서 생성형 AI의 도움을 받아 실험 진행. 머리가 많이 복잡해진 상태에서 별 생각없이 venv를 리셋하고 처음부터 다시 라이브러리 설치 과정을 실험.
- 똑같이 했는데 이번에는 디스크 부족으로 설치가 안됨.
- 캐시 지우기 또는 비활성화, venv 지웠다가 재생성 등 20G내에서 디스크 부족 문제를 해결하기 위해 노력했지만 실패
- 빨리 서버가 작동하게 만들어야했기에 더 이상의 원인 규명 시도는 멈추고 EBS 30G로 확장하여 설치 성공

# 조사
- 설치된 라이브러리들의 용량을 살펴보자.
```
ubuntu@ip-172-31-29-122:~$ du -h --max-depth=1 ~/ai/venv/lib/python3.10/site-packages/ | sort -rh | head -n 20
7.2G    /home/ubuntu/ai/venv/lib/python3.10/site-packages/
4.3G    /home/ubuntu/ai/venv/lib/python3.10/site-packages/nvidia
1.7G    /home/ubuntu/ai/venv/lib/python3.10/site-packages/torch
592M    /home/ubuntu/ai/venv/lib/python3.10/site-packages/triton
109M    /home/ubuntu/ai/venv/lib/python3.10/site-packages/scipy
98M     /home/ubuntu/ai/venv/lib/python3.10/site-packages/transformers
65M     /home/ubuntu/ai/venv/lib/python3.10/site-packages/pandas
57M     /home/ubuntu/ai/venv/lib/python3.10/site-packages/sympy
46M     /home/ubuntu/ai/venv/lib/python3.10/site-packages/sklearn
41M     /home/ubuntu/ai/venv/lib/python3.10/site-packages/numpy
27M     /home/ubuntu/ai/venv/lib/python3.10/site-packages/scipy.libs
27M     /home/ubuntu/ai/venv/lib/python3.10/site-packages/numpy.libs
17M     /home/ubuntu/ai/venv/lib/python3.10/site-packages/grpc
15M     /home/ubuntu/ai/venv/lib/python3.10/site-packages/networkx
14M     /home/ubuntu/ai/venv/lib/python3.10/site-packages/pip
13M     /home/ubuntu/ai/venv/lib/python3.10/site-packages/uvloop
12M     /home/ubuntu/ai/venv/lib/python3.10/site-packages/openai
11M     /home/ubuntu/ai/venv/lib/python3.10/site-packages/tokenizers
8.0M    /home/ubuntu/ai/venv/lib/python3.10/site-packages/hf_xet
5.0M    /home/ubuntu/ai/venv/lib/python3.10/site-packages/pydantic_core
```
- 이상하다. torch는 제외돼야하는데? 지금 req.txt에서 torch는 주석처리돼있다.
- nvidia는 뭔데 저렇게 무겁지?
    - CUDA 라이브러리. 파이토치가 이걸 필요로 해서 설치됨.
- 1, 2위인 torch와 nvidia를 제외하곤 전부 1G를 넘지 않기 때문에 영향이 크지 않다. 주범은 torch였다.
- 왜 torch가 제외되지 않았는지 알아보자.
```
/home/ubuntu/ai/venv/bin/pip show torch
Name: torch
Version: 2.9.1
Summary: Tensors and Dynamic neural networks in Python with strong GPU acceleration
Home-page: 
Author: 
Author-email: PyTorch Team <packages@pytorch.org>
License: BSD-3-Clause
Location: /home/ubuntu/ai/venv/lib/python3.10/site-packages
Requires: filelock, fsspec, jinja2, networkx, nvidia-cublas-cu12, nvidia-cuda-cupti-cu12, nvidia-cuda-nvrtc-cu12, nvidia-cuda-runtime-cu12, nvidia-cu
dnn-cu12, nvidia-cufft-cu12, nvidia-cufile-cu12, nvidia-curand-cu12, nvidia-cusolver-cu12, nvidia-cusparse-cu12, nvidia-cusparselt-cu12, nvidia-nccl-cu12, nvidia-nvjitlink-cu12, nvidia-nvshmem-cu12, nvidia-nvtx-cu12, sympy, triton, typing-extensions
Required-by: sentence-transformers
```
- Required-by를 보면 sentence-transformers가 있다. 이 라이브러리가 torch를 요구했기 때문에 주석처리했음에도 torch가 설치됐던 것.
- jayvi가 sentence-transformers는 MVP에서도 꼭 필요한 기능이라 하므로 nvidia와 torch를 설치는 필수불가결.
- 결과론적으론 30G로 증설한 것은 잘 한 것이다. 현재 시스템에서 사용된 저장공간이 15G이기 때문이다. 20G인 실정이라면 여유가 5G밖에 되지 않으므로 상당히 불안정한 상태였을 것이다.